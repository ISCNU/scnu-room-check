# SCNU Classroom Checker
华南师范大学教室使用情况查询 API  

# 简介
本程序依托教务处公开的全校课表数据，可以提供当天所有校区的教学楼上课情况（暂未包含课室借用的情况），供前端“我要自习”应用使用。  
数据来源：正方教务系统->公用信息->课表查询

# 数据的准备
本程序需要手动添加数据，因此每个学期都需要更新一次。更新流程如下：
1. `git clone` 代码至本地，并用 npm 装好依赖
2. 把 `config.js` 的学期参数，修改为目标的学期，格式：学年-学期，如 2018-2019第一学期则为 `2018-2019-1`，另外还需要把学期的开始日期修改好
3. 在 `data` 目录创建一个以该学期命名的目录，如 `data/2018-2019-1`
4. 进入教务系统，登录，打开 `公用信息->课表查询`
5. 直接点击 `按条件查询上课情况`，稍等几秒钟，得到全校的课表数据（大概6000多条）
6. `Ctrl+A` 全选，复制，在 Excel 中粘贴，删去除表格外上方的无用数据
7. 保存Excel，格式选择csv，文件名为`学年-学期.csv`，如 `2018-2019-1.csv`，保存位置在 `data/{学期}`，一定要保证文件名一致
8. `node scripts/generate-db.js` 开始生成 sqlite 数据库，大约需要一个小时左右
9. 生成完毕后，将当前的改动 commit, push

# 部署
## 依赖
* Node.js >= 7.6, 推荐 8.x LTS 版本

## 安装启动过程
1. 安装依赖
```
npm install
```

2. 启动
```
node index.js
```
若用 PM2 管理，则为
```
pm2 index.js
```
程序默认监听 3000 端口提供 HTTP 服务，可通过设置 PORT 环境变量改变端口号

生产环境中可以通过进程管理器(例如 pm2)启动
